---
title: Principal component analysis
subtitle: Modern multivariate statistical techniques
author: Miguel Rodo
date: "2024-02-12"
bibliography: zotero.bib
format:
  html:
    embed-resources: true
    urlcolor: cyan
    linkcolor: blue
    filecolor: magenta
---

# Tidy data for demonstration and assessment

## All Vula files

```{r}
library(tibble)
library(readr)
library(readxl)

for (x in list.files("R", full.names = TRUE)) {
  source(x)
}
# List of files
files_to_read <- c(
  "Air Pollution Data.csv", "J_WEx6.11.RData", "NationalTrack.csv",
  "T1-3.txt", "T4-1.DAT", "T4-5.DAT", "T5-1.DAT", "T6_16_DENTAL.DAT",
  "T6-4.dat", "T7-6.DAT", "J_WEx5.9.Rdata", "Lizard.csv", "T1-2.txt",
  "T1-4.txt", "T4-3.DAT", "T5-12.dat", "T6-11.dat", "T6-17.dat",
  "T7-1.DAT", "T7-7.dat"
)

# Read all files into a list of tibbles
list_of_tibbles <- lapply(files_to_read, read_file) |>
  setNames(files_to_read)

tibble_vec_null_ind <- sapply(list_of_tibbles, is.null) |> which()
files_to_read[tibble_vec_null_ind]
```

## House price data

```{r}
data_tidy_house_price <- list_of_tibbles[["T7-1.DAT"]]
projr::projr_use_data(data_tidy_house_price, overwrite = TRUE)
```

## Paper

```{r}
data_tidy_paper <- list_of_tibbles[["T7-7.dat"]]
projr::projr_use_data(data_tidy_paper, overwrite = TRUE)
```

## Turtle

```{r}
data_raw_turtle <- readr::read_csv(
  projr::projr_path_get("data-raw", "turtle.csv")
)
data_tidy_turtle <- data_raw_turtle |>
  janitor::clean_names() |>
  dplyr::mutate(dplyr::across(where(is.character), tolower))
projr::projr_use_data(data_tidy_turtle, overwrite = TRUE)
```

## Mali family farm data

```{r}
data_raw_mali <- readr::read_csv(
  projr::projr_path_get("data-raw", "MaliFamilyFarmData.csv")
)
data_tidy_mali <- data_raw_mali |>
  janitor::clean_names()
projr::projr_use_data(data_tidy_mali, overwrite = TRUE)
```

## Air pollution

```{r}
data_raw_air <- list_of_tibbles[["Air Pollution Data.csv"]]
data_tidy_air <- data_raw_air |>
  janitor::clean_names()
projr::projr_use_data(data_tidy_air, overwrite = TRUE)
```

## Profitability measures

```{r}
#| results: asis
#| echo: false
var_vec <- c(
  "Historical return on assets (HRA)",
  "Historical return on equity (HRE)",
  "Historical return on sales (HRS)",
  "Replacement return on assets (RA)",
  "Replacement return on equity (RRE)",
  "Replacement return on sales (RRS)",
  "Market Q ratio (Q)",
  "Market relative excess value (REV)"
)
hra_vec <- c(1, 0.738, 0.731, 0.828, 0.681, 0.712, 0.625, 0.604)
hre_vec <- c(NA_real_, 1, 0.52, 0.688, 0.831, 0.543, 0.322, 0.303)
hrs_vec <- c(NA_real_, NA_real_, 1, 0.652, 0.5113, 0.826, 0.579, 0.617)
rra_vec <- c(NA_real_, NA_real_, NA_real_, 1, 0.887, 0.867, 0.639, 0.563)
rre_vec <- c(NA_real_, NA_real_, NA_real_, NA_real_, 1, 0.692, 0.419, 0.352)
rrs_vec <- c(NA_real_, NA_real_, NA_real_, NA_real_, NA_real_, 1, 0.608, 0.610)
q_vec <- c(NA_real_, NA_real_, NA_real_, NA_real_, NA_real_, NA_real_, 1, 0.937)
rev_vec <- c(NA_real_, NA_real_, NA_real_, NA_real_, NA_real_, NA_real_, NA_real_, 1)
corr_tbl <- tibble::tibble(
  Variable = var_vec,
  HRA = hra_vec,
  HRE = hre_vec,
  HRS = hrs_vec,
  RRA = rra_vec,
  RRE = rre_vec,
  RRS = rrs_vec,
  Q = q_vec,
  REV = rev_vec
)
corr_mat <- matrix(c(
  HRA = hra_vec,
  HRE = hre_vec,
  HRS = hrs_vec,
  RRA = rra_vec,
  RRE = rre_vec,
  RRS = rrs_vec,
  Q = q_vec,
  REV = rev_vec
), nrow = 8, byrow = FALSE)
for (i in seq_len(nrow(corr_mat))) {
  for (j in seq_len(nrow(corr_mat))) {
    if (is.na(corr_mat[i, j])) corr_mat[i, j] <- corr_mat[j, i]
  }
}
corr_mat_profit <- corr_mat
projr::projr_use_data(corr_mat_profit, overwrite = TRUE)
```

## Chicken bone

```{r}
data_raw_chicken_bone <- readr::read_table(
  projr::projr_path_get(
    "data-raw", "chickenbone.txt"
  ),
  col_names = FALSE
)
data_tidy_chicken_bone <- data_raw_chicken_bone |>
  dplyr::select(X2:X5)
colnames(data_tidy_chicken_bone) <-
  c(
    "skull_length", "skull_breadth", "femur_length", "tibia_length"
  )
projr::projr_use_data(data_tidy_chicken_bone, overwrite = TRUE)
```